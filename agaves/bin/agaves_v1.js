window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();var B={b2Vec2:Box2D.Common.Math.b2Vec2,b2Transform:Box2D.Common.Math.b2Transform,b2Mat22:Box2D.Common.Math.b2Mat22,b2AABB:Box2D.Collision.b2AABB,b2ContactListener:Box2D.Dynamics.b2ContactListener,b2BodyDef:Box2D.Dynamics.b2BodyDef,b2Body:Box2D.Dynamics.b2Body,b2FixtureDef:Box2D.Dynamics.b2FixtureDef,b2Fixture:Box2D.Dynamics.b2Fixture,b2World:Box2D.Dynamics.b2World,b2MassData:Box2D.Collision.Shapes.b2MassData,b2PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape:Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw:Box2D.Dynamics.b2DebugDraw,b2MouseJointDef:Box2D.Dynamics.Joints.b2MouseJointDef,b2Color:Box2D.Common.b2Color,b2WorldManifold:Box2D.Collision.b2WorldManifold},Agaves={WIDTH:960,HEIGHT:500,SPEED:3,PRECISION:10,RATIO:50,GRAVITY:3,VIEW_DELAY:10,SCALE:1,container:null,scene:null,player:null,graphics:null,graphicsImage:null,debugLayer:null,layer:null,staticLayer:null,backgroundLayer:null,world:null,level:null,targetViewX:0,targetViewY:0,dynamics:[],debug:!1,debugDraw:null,contactListener:null,_running:!1,levelLoaded:!1,levelDestroyed:!1,backgroundWidth:0,backgroundHeight:0,start:function(a,b){this.container=b,Agaves.AssetsManager.base=a,Agaves.AssetsManager.load(function(){Agaves.Interface.initialize(),Agaves.initialize()})},loadLevel:function(a,b){Agaves.AssetsManager.loadLevel(a,function(a){Agaves.level=a.json,Agaves.backgroundWidth=a.background.width,Agaves.backgroundHeight=a.background.height,Agaves.staticLayer.image.src=a.image.src,Agaves.container.style.backgroundImage="url("+a.background.src+")",Agaves.levelLoaded=!0,b(a)})},destroyLevel:function(){var a=this.world.GetBodyList();this.world.DestroyBody(a);while(a=a.GetNext())this.world.DestroyBody(a);this.layer.removeAll(),this.levelDestroyed=!0},initialize:function(){Agaves.Mouse.initialize(this.container),Agaves.Keyboard.onKeyDown=Agaves.onKeyDown,this.world=new B.b2World(new B.b2Vec2(0,this.GRAVITY),!0),this.world.SetContactListener(Agaves.ContactListener),this.graphicsImage=Agaves.AssetsManager.get("graphicsImage"),this.graphics=Agaves.AssetsManager.get("graphicsJSON"),this.initializeScene(),this.staticLayer=new Agaves.ImageLayer(this.scene),this.layer=new Agaves.Layer(this.scene,this.WIDTH,this.HEIGHT),this.initializeDebug()},startGame:function(){this.addBoxStatics(this.level.statics),this.addObjects(this.level.dynamics),this.addKinematics(this.level.kinematics),this.addEnemies(this.level.enemies),this.initializePlayer(),this.layer.add(this.player);var a=this.player.box2d.GetPosition();this.updateView(a.x,a.y,!0),Agaves.Keyboard.clearBuffer(),Agaves.resumeGame()},resumeGame:function(){this.levelLoaded?this._running||(this._running=!0,this.onFrame()):console.log("ERROR: level not loaded")},pauseGame:function(){this._running=!1},addBoxStatics:function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.id,e=new B.b2BodyDef;e.type=B.b2Body.b2_staticBody;var f=this.world.CreateBody(e),g=Agaves.utils.jsonToFixture(c.fixture),h=Agaves.ObjectType.PLATFORM;d.match(/^ladder/)&&(g.isSensor=!0,h=Agaves.ObjectType.LADDER),d.match(/^fire/)&&(g.isSensor=!0,h=Agaves.ObjectType.FIRE),d.match(/^exit/)&&(g.isSensor=!0,h=Agaves.ObjectType.EXIT),d.match(/^enemy\-1\-stop\-left/)&&(g.isSensor=!0,h=Agaves.ObjectType.ENEMY_STOP_LEFT),d.match(/^enemy\-1\-stop\-right/)&&(g.isSensor=!0,h=Agaves.ObjectType.ENEMY_STOP_RIGHT),d.match(/^oneside/)&&(h=Agaves.ObjectType.PLATFORM_ONE_SIDE),d.match(/^platform\-moving/)&&(h=Agaves.ObjectType.PLATFORM_MOVING),f.objectType=h,f.CreateFixture(g)}},addObjects:function(a){for(var b=0;b<a.length;b++){var c=a[b],d=new Agaves.SpriteDefinition(this.graphics[c.id],this.graphicsImage);switch(c.id){case"coin":var e=new Agaves.CoinSprite(d);break;default:var e=new Agaves.Sprite(d)}e.x=c.x,e.y=c.y,e.addToWorld(this.world,this.layer)}},addEnemies:function(a){for(var b=0;b<a.length;b++){var c=a[b],d=new Agaves.SpriteDefinition(this.graphics[c.id],this.graphicsImage),e=c.rgb[1]==0?Agaves.Direction.LEFT:Agaves.Direction.RIGHT;switch(c.id){case"enemy-1":var f=new Agaves.WalkingEnemy(d,e);break;case"enemy-2":var f=new Agaves.FlyingEnemy(d,e);break;case"enemy-3":var f=new Agaves.StandingEnemy(d,e)}f.x=c.x,f.y=c.y,f.addToWorld(this.world,this.layer)}},addKinematics:function(a){for(var b=0;b<a.length;b++){var c=a[b],d=new Agaves.SpriteDefinition(this.graphics[c.id],this.graphicsImage);d.box2dDefinitions.bodyDef.type="kinematic";var e=new Agaves.KinematicSprite(d,c.path,c.speed);e.x=c.x,e.y=c.y,e.addToWorld(this.world,this.layer)}},onFrame:function(){Agaves._running&&(Agaves.Keyboard.fireEvents(),Agaves.processPlayer(),Agaves.updateWorld(),Agaves.scene.render(),window.requestAnimFrame(Agaves.onFrame))},onKeyDown:function(a){switch(a){case Agaves.Keyboard.G:Agaves.scene.go();break;case Agaves.Keyboard.Y:Agaves.debug=!Agaves.debug,Agaves.debug||Agaves.debugLayer.context.clearRect(0,0,Agaves.scene.width,Agaves.scene.height);break;case Agaves.Controls.FIRE:Agaves.player.fire()}},processPlayer:function(){var a=Agaves.player;Agaves.Keyboard.isPressed(Agaves.Controls.LEFT)?a.goLeft():Agaves.Keyboard.isPressed(Agaves.Controls.RIGHT)?a.goRight():a.applyFriction(),Agaves.Keyboard.isPressed(Agaves.Controls.JUMP)&&a.jump(),a.update();return;var b=!1,c=a.box2d.GetTransform()},initializePlayer:function(){var a=new Agaves.SpriteDefinition(this.graphics.player,this.graphicsImage);this.player=new Agaves.PlayerSprite(a,this.world),this.player.setPosition(this.level.player.x,this.level.player.y),this.player.onKill=function(){Agaves.player.animate({start:21,end:29,speed:10,callback:function(){Agaves.pauseGame(),Agaves.Interface.playerDead()}})},this.player.onExit=function(){Agaves.pauseGame(),Agaves.Interface.nextLevel()}},initializeScene:function(){this.scene=new Agaves.Scene({width:this.WIDTH,height:this.HEIGHT,fps:this.FPS,container:this.container,scale:this.SCALE})},initializeDebug:function(){this.debugLayer=new Agaves.Layer(this.scene,this.WIDTH,this.HEIGHT),this.debugLayer.disabled=!0,this.debugDraw=new Box2D.Dynamics.b2DebugDraw,this.debugDraw.SetSprite(this.debugLayer.context),this.debugDraw.SetDrawScale(this.RATIO),this.debugDraw.SetFillAlpha(.5),this.debugDraw.SetLineThickness(.5),this.debugDraw.SetFlags(B.b2DebugDraw.e_shapeBit|B.b2DebugDraw.e_jointBit),this.world.SetDebugDraw(this.debugDraw)},updateWorld:function(){this.world.Step(this.SPEED/50,this.PRECISION,this.PRECISION),this.updateDynamics();var a=this.player.box2d.GetPosition();this.updateView(a.x,a.y,!1),this.debug&&(this.debugLayer.context.clearRect(0,0,Agaves.scene.width,Agaves.scene.height),this.debugLayer.context.save(),this.debugLayer.context.translate(-this.scene.viewX,-this.scene.viewY),this.debugLayer.context.scale(this.SCALE,this.SCALE),this.world.DrawDebugData(),this.debugLayer.context.restore()),this.world.ClearForces()},updateView:function(a,b,c){var c=c||!1,d=a*Agaves.RATIO*this.SCALE,e=b*Agaves.RATIO*this.SCALE;this.targetViewX=d-this.WIDTH/2,this.targetViewY=e-this.HEIGHT/2,this.targetViewX<0?this.targetViewX=0:this.targetViewX>this.SCALE*this.level.width-this.scene.width&&(this.targetViewX=this.SCALE*this.level.width-this.scene.width),this.targetViewY<0?this.targetViewY=0:this.targetViewY>this.SCALE*this.level.height-this.scene.height&&(this.targetViewY=this.SCALE*this.level.height-this.scene.height),c?(this.scene.viewX=this.targetViewX,this.scene.viewY=this.targetViewY):(this.scene.viewX+=(this.targetViewX-this.scene.viewX)/this.VIEW_DELAY,this.scene.viewY+=(this.targetViewY-this.scene.viewY)/this.VIEW_DELAY);var f=this.scene.viewX/(this.level.width-this.scene.width),g=this.scene.viewY/(this.level.height-this.scene.height),h=this.WIDTH-this.backgroundWidth,i=this.HEIGHT-this.backgroundHeight,j=Math.round(i*g),k=Math.round(h*f);this.scene.container.style.backgroundPosition=k+"px "+j+"px"},updateDynamics:function(){for(var a=0;a<this.layer.objects.length;a++){var b=this.layer.objects[a];b.destroy?this.world.DestroyBody(b.box2d):b.process&&b.process(),b.visible=!1}var c=new B.b2AABB;c.lowerBound=new B.b2Vec2(this.scene.viewX/this.RATIO,this.scene.viewY/this.RATIO),c.upperBound=new B.b2Vec2((this.scene.viewX+this.WIDTH*this.scale)/this.RATIO,(this.scene.viewY+this.HEIGHT*this.scale)/this.RATIO),this.world.QueryAABB(function(a){var b=a.GetBody();b.dynamic&&(b.sprite.visible=!0);return!0},c)}};Agaves.Interface={State:{MAIN_MENU:"mainMenu",PLAYER_DEAD:"playerDead",PAUSE:"pause",LOADING:"loading",ESCAPE_MENU:"escapeMenu",PLAYING:"playing",NEXT_LEVEL:"nextLevel",THE_END:"theEnd",LEVEL_INTRO:"levelIntro"},currentLevel:0,totalLevels:4,state:"mainMenu",mainMenu:function(){this.hideAll(),this.state=this.State.MAIN_MENU,$("#mainMenu").show()},playerDead:function(){this.hideAll(),$("#playerDead").show(),this.state=this.State.PLAYER_DEAD},pauseGame:function(){this.hideAll(),this.state=this.State.PAUSE,$("#gamePaused").show()},loadingLevel:function(){this.hideAll(),this.state=this.State.LOADING,$("#loadingLevel").show()},escapeMenu:function(){this.hideAll(),this.state=this.State.ESCAPE_MENU,$("#escapeMenu").show()},hideAll:function(){$("#interfaceWrapper .interface").hide(),this.state=this.State.PLAYING},levelIntro:function(){this.hideAll(),this.state=this.State.LEVEL_INTRO,$("#levelIntro").show()},nextLevel:function(){this.hideAll(),Agaves.Interface.currentLevel++,Agaves.Interface.currentLevel<Agaves.Interface.totalLevels?(this.state=this.State.NEXT_LEVEL,$("#nextLevel").show()):(this.state=this.State.THE_END,$("#theEnd").show())},initialize:function(){$(window).keydown(function(a){switch(a.keyCode){case Agaves.Keyboard.ESCAPE:Agaves.Interface.state==Agaves.Interface.State.PLAYING?(Agaves.pauseGame(),Agaves.Interface.escapeMenu()):Agaves.Interface.state==Agaves.Interface.State.ESCAPE_MENU&&(Agaves.resumeGame(),Agaves.Interface.hideAll());break;case Agaves.Keyboard.P:Agaves.Interface.state==Agaves.Interface.State.PAUSE?(Agaves.Interface.hideAll(),Agaves.resumeGame()):(Agaves.Interface.pauseGame(),Agaves.pauseGame());break;case Agaves.Controls.FIRE:case Agaves.Controls.JUMP:Agaves.Interface.state==Agaves.Interface.State.PLAYER_DEAD?(Agaves.Keyboard.clearBuffer(),Agaves.Interface.loadingLevel(),Agaves.destroyLevel(),Agaves.loadLevel(Agaves.Interface.currentLevel,function(){Agaves.Interface.hideAll(),Agaves.startGame()})):Agaves.Interface.state==Agaves.Interface.State.THE_END?$("#buttonTheEnd").click():Agaves.Interface.state==Agaves.Interface.State.NEXT_LEVEL&&$("#buttonNextLevel").click()}}),$("#buttonExit,#buttonTheEnd").click(function(){Agaves.destroyLevel(),Agaves.Interface.mainMenu()}),$("#buttonResume").click(function(){Agaves.Interface.hideAll(),Agaves.resumeGame()}),$("#buttonRestart").click(function(){Agaves.Interface.loadingLevel(),Agaves.destroyLevel(),Agaves.loadLevel(Agaves.Interface.currentLevel,function(){Agaves.Interface.hideAll(),Agaves.startGame()})}),$("#buttonNextLevel").click(function(){Agaves.Interface.loadingLevel(),Agaves.destroyLevel(),Agaves.loadLevel(Agaves.Interface.currentLevel,function(){Agaves.Interface.hideAll(),Agaves.startGame()})}),$(".buttonLoadLevel").click(function(){if(!$(this).hasClass("locked")){var a=parseInt(this.id.substr(6));Agaves.Interface.currentLevel=a,Agaves.Interface.loadingLevel(),Agaves.loadLevel(a,function(a){$("#levelIntro div.message").html(a.name),$("#levelIntro p").html(a.caption),Agaves.Interface.levelIntro()})}}),$("#buttonStartLevel").click(function(){Agaves.Interface.hideAll(),Agaves.startGame()}),$("#buttonPlayerDeadPlay").click(function(){Agaves.Keyboard.clearBuffer(),Agaves.Interface.loadingLevel(),Agaves.destroyLevel(),Agaves.loadLevel(Agaves.Interface.currentLevel,function(){Agaves.Interface.hideAll(),Agaves.startGame()})}),$("#buttonPauseResume").click(function(){Agaves.Interface.hideAll(),Agaves.resumeGame()})}},Agaves.Levels=[{name:"Test level",caption:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",dir:"0",background:"background.png"},{name:"The beginning!",caption:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",dir:"1",background:"background.png"},{name:"It's a trap!",caption:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",dir:"2",background:"background.png"},{name:"Spikes",caption:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",dir:"3",background:"background.png"},{name:"At the castle",caption:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",dir:"4",background:"background.png"}],Agaves.Direction={LEFT:1,RIGHT:2,UP:4,DOWN:8},Agaves.Random={getInteger:function(a,b){return Math.round(this.getFloat(a,b))},getFloat:function(a,b){var c=a+Math.random()*(b-a);return c}},Agaves.utils={arrayToVertices:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];b.push(new B.b2Vec2(d.x,d.y))}return b},jsonToShape:function(a){var b=null;if(a.type=="circle")b=new B.b2CircleShape(a.radius),b.SetLocalPosition(new B.b2Vec2(a.x,a.y));else{var c=this.arrayToVertices(a.vertices);b=new B.b2PolygonShape,b.SetAsArray(c,c.length)}return b},jsonToFixture:function(a){var b=new B.b2FixtureDef;b.density=a.density,b.friction=a.friction,b.restitution=a.restitution,b.shape=this.jsonToShape(a.shape);return b},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}},Agaves.Keyboard={keys:[],buffer:[],A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ESCAPE:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,isPressed:function(a){return this.keys[a]===!0},fireEvents:function(){for(var a=0,b=this.buffer.length;a<b;a++)this.onKeyDown(this.buffer.pop())},clearBuffer:function(){this.buffer=[]},onKeyDown:function(a){},_keyDown:function(a){this.keys[a]||(this.keys[a]=!0,this.buffer.push(a))},_keyUp:function(a){this.keys[a]=!1}},window.onkeydown=function(a){Agaves.Keyboard._keyDown(a.keyCode)},window.onkeyup=function(a){Agaves.Keyboard._keyUp(a.keyCode)},Agaves.Mouse={x:0,y:0,world:null,container:null,initialize:function(a){this.container=a,this.container.onmousemove=this._onMouseMove,Agaves.Mouse.world=new B.b2Vec2(0,0)},_onMouseMove:function(a){Agaves.Mouse.x=a.offsetX,Agaves.Mouse.y=a.offsetY,Agaves.Mouse.world.Set((Agaves.scene.viewX+Agaves.Mouse.x)/Agaves.RATIO,(Agaves.scene.viewY+Agaves.Mouse.y)/Agaves.RATIO)}},Agaves.Controls={LEFT:Agaves.Keyboard.A,RIGHT:Agaves.Keyboard.D,JUMP:Agaves.Keyboard.L,FIRE:Agaves.Keyboard.K,UP:Agaves.Keyboard.W,DOWN:Agaves.Keyboard.S},Agaves.Layer=Class.extend({context:null,scene:null,objects:[],x:0,y:0,width:0,height:0,scale:1,disabled:!1,visible:!0,init:function(a,b,c){this.width=b,this.height=c,this.scene=a;var d=document.createElement("canvas");d.width=this.width,d.height=this.height,d.style.position="absolute",this.scene.container.appendChild(d);var e=d.getContext("2d");this.context=e,this.scene.layers.push(this)},add:function(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this._addObject(a[b]);else this._addObject(a)},_addObject:function(a){a.parentObject=this,a.index=this.objects.length,this.objects.push(a)},removeAll:function(){for(var a=0;a<this.objects.length;a++)delete this.objects[a];this.objects=[],this.context.canvas.width=this.width},_x:0,_y:0,_scale:0,unrender:function(){if(!this.disabled){this.context.save(),this.context.translate(this._x,this._y),this.context.scale(this._scale,this._scale);for(var a in this.objects){var b=this.objects[a];b.unrender(this.context)}this.context.restore()}},render:function(a,b){if(!this.disabled){this.context.save(),this.context.translate(-a,-b),this.context.scale(this.scale,this.scale);for(var c in this.objects){var d=this.objects[c];d.destroy&&this.objects.splice(c,1)}for(var c in this.objects){var d=this.objects[c];d.render(this.context)}this.context.restore(),this._x=-a,this._y=-b,this._scale=this.scale}}}),Agaves.ImageLayer=Class.extend({image:null,scene:null,x:0,y:0,scale:1,disabled:!1,visible:!0,init:function(a,b){this.image=b||new Image,this.scene=a,this.scene.layers.push(this),this.scene.container.appendChild(this.image),this.image.style.position="absolute"},unrender:function(){},render:function(a,b){this.visible?this.disabled||(this.image.style.display="block",this.image.style.top=-b+"px",this.image.style.left=-a+"px"):this.image.style.display="none"}}),Agaves.Scene=Class.extend({context:null,layers:[],width:0,height:0,scale:1,container:null,viewX:0,viewY:0,init:function(a){Agaves.utils.extend(this,a)},render:function(){for(var a=0,b=this.layers.length;a<b;a++){var c=this.layers[a];c.unrender(),c.render(Math.round(this.viewX),Math.round(this.viewY))}}}),Agaves.ObjectType={PLAYER:"player",PLATFORM:"platform",PLATFORM_ONE_SIDE:"platform_one_side",PLATFORM_MOVING:"platform_moving",BULLET:"bullet",ENEMY:"enemy",ENEMY_STOP_LEFT:"enemy_stop_left",ENEMY_STOP_RIGHT:"enemy_stop_right",ENEMY_BULLET:"enemy_bullet",FIRE:"fire",LADDER:"ladder",BUTTON:"button",SWITCH:"switch",COIN:"coin",ENTRANCE:"entrance",EXIT:"exit"},Agaves.CollisionGroup={PLAYER:2,BULLET:4,ENEMY:8,ENEMY_BULLET:16},Agaves.BodyType={SOLID:"solid",SENSOR:"sensor",BULLET:"bullet",ENEMY:"enemy"},Agaves.AssetsManager={base:"folder",assets:[],assetsToLoad:[{name:"graphicsJSON",url:"graphics/graphics.json?"+Math.random()},{name:"graphicsImage",url:"graphics/graphics.png"}],get:function(a){return this.assets[a]},loadLevel:function(a,b){var c=Agaves.Levels[a],d=this.base+"assets/levels/"+c.dir+"/",e=d+"level"+a+".json?"+Math.random(),f=d+"level"+a+".png?"+Math.random(),g=this.base+"assets/levels/backgrounds/"+c.background,h={};$.getJSON(e,function(a){h.image=new Image,h.background=new Image,h.json=a,h.name=c.name,h.caption=c.caption,h.background.onload=function(){b(h)},h.image.onload=function(){h.background.src=g},h.image.src=f})},load:function(a){var b=this,c=this.assetsToLoad.pop();if(c!=undefined){var d=this.base+"assets/"+c.url;if(c.url.split(".").pop().match(/^png|jpeg|jpg|gif/)){var e=new Image;e.onload=function(b){Agaves.AssetsManager.assets[c.name]=e,Agaves.AssetsManager.load(a)},e.src=d}else $.getJSON(d,function(b){Agaves.AssetsManager.assets[c.name]=b,Agaves.AssetsManager.load(a)})}else a()}},Agaves.SpriteDefinition=Class.extend({init:function(a,b){Agaves.utils.extend(this,a),this.image=b}}),Agaves.Sprite=Class.extend({objectType:null,bodyType:null,box2d:null,box2dDefinitions:null,image:null,sheetX:0,sheetY:0,width:0,height:0,visible:!0,destroy:!1,frame:0,x:0,y:0,scaleX:1,scaleY:1,_toDelete:!1,_x:0,_y:0,_angle:0,animating:!1,_start:0,_end:0,_step:1,_callback:null,_onFrame:null,_speed:1,_currentSpeedCount:1,init:function(a){this.box2dDefinitions=a.box2dDefinitions,this.image=a.image,this.sheetX=a.x,this.sheetY=a.y,this.width=a.width,this.height=a.height},addToWorld:function(a,b){var c=this.box2dDefinitions,d=new B.b2BodyDef;d.bullet=c.bodyDef.bullet;switch(c.bodyDef.type){case"dynamic":d.type=B.b2Body.b2_dynamicBody;break;case"static":d.type=B.b2Body.b2_staticBody;break;case"kinematic":d.type=B.b2Body.b2_kinematicBody}this.box2d=a.CreateBody(d),this.box2d.SetPosition(new B.b2Vec2(this.x,this.y));var e=c.fixDefs;for(var f=0;f<e.length;f++){var g=c.fixDefs[f],h=Agaves.utils.jsonToFixture(g);this.box2d.CreateFixture(h)}this.box2d.sprite=this,this.box2d.dynamic=!0,b&&b.add(this),this.configure()},configure:function(){},animate:function(a){this._start=a.start||0,this._end=a.end||0,this._speed=a.speed||1,this._currentSpeedCount=this._speed,this._step=a.end>a.start?1:-1,this._callback=a.callback||null,this._onFrame=a.onFrame||null,this.frame=this._start,this.animating=!0},_doAnimation:function(){this.animating&&(this.frame!=this._end?(this._currentSpeedCount--,this._currentSpeedCount==0&&(this.frame+=this._step,this._onFrame&&this._onFrame(this,this.frame),this._currentSpeedCount=this._speed)):(this.animating=!1,this._callback&&this._callback(this)))},render:function(a){if(this.visible){var b=this.box2d.GetPosition(),c=b.x*Agaves.RATIO,d=b.y*Agaves.RATIO,e=this.box2d.GetAngle();a.save(),a.translate(c,d),a.scale(this.scaleX,this.scaleY),a.rotate(e),this.scaleX==-1&&a.translate(-this.width,0),a.drawImage(this.image,this.sheetX+this.width*this.frame,this.sheetY,this.width,this.height,0,0,this.width,this.height),a.restore(),this._toDelete=!0,this._x=c,this._y=d,this._angle=e}this._doAnimation()},unrender:function(a){this._toDelete&&(a.save(),a.translate(this._x,this._y),a.rotate(this._angle),a.clearRect(-1,-1,this.width+2,this.height+2),a.restore())},clone:function(){return Agaves.utils.extend({},this)}}),Agaves.CoinSprite=Agaves.Sprite.extend({init:function(a){this._super(a)},configure:function(){this.box2d.ignoreGravity=!0,this.box2d.objectType=Agaves.ObjectType.COIN;var a=this.box2d.GetFixtureList();a.SetSensor(!0)},collect:function(){var a=new B.b2Vec2(0,-40/Agaves.RATIO);this.box2d.ApplyImpulse(a,this.box2d.GetWorldCenter()),this.animate({start:1,end:7,speed:2,callback:function(a){a.destroy=!0}})}}),Agaves.KinematicSprite=Agaves.Sprite.extend({path:[],speed:0,currentPathIndex:0,init:function(a,b,c){this._super(a),this.path=b,this.path.push(this.path[0]),this.speed=c},configure:function(){this.box2d.objectType=Agaves.ObjectType.PLATFORM_MOVING,this.calculateVelocity(),this.currentPathIndex=0,this.box2d.SetPosition(new B.b2Vec2(this.x,this.y))},calculateVelocity:function(){var a=this.path,b=this.currentPathIndex,c=a[b+1].x-a[b].x,d=a[b+1].y-a[b].y,e=new B.b2Vec2(c,d);e.Normalize(),e.Multiply(.1),e.Multiply(this.speed),this.box2d.SetLinearVelocity(e)},process:function(){var a=this.currentPathIndex,b=this.box2d.GetPosition(),c=Math.round(b.x*Agaves.RATIO),d=Math.round(b.y*Agaves.RATIO),e=this.path[a+1].x,f=this.path[a+1].y;if(c==e&&d==f){this.currentPathIndex++,this.currentPathIndex%=this.path.length-1;var g=new B.b2Vec2(e/Agaves.RATIO,f/Agaves.RATIO);this.box2d.SetPosition(g),this.calculateVelocity()}}}),Agaves.PlayerSprite=Agaves.Sprite.extend({MAX_VELOCITY:1,MAX_VELOCITY_CAP:1.3,ACCELERATION:.3,VERTICAL_VELOCITY:2.5,DAMPING:.3,FRICTION:.7,JUMP:4,Direction:{LEFT:1,RIGHT:2},State:{IDLE:1,WALK:2,DEAD:3},state:null,direction:null,fixtureFeet:null,fixtureBody:null,fixtureLegs:null,fixtureSensor:null,feetContact:!0,isDead:!1,onKill:null,bulletDefinition:null,init:function(a,b){a.box2dDefinitions.bodyDef.bullet=!0,this._super(a),this.addToWorld(b),this.box2d.SetFixedRotation(!0),this.box2d.SetSleepingAllowed(!1),this.box2d.objectType=Agaves.ObjectType.PLAYER,this.fixtureFeet=this.box2d.GetFixtureList(),this.fixtureFeet.m_filter.categoryBits=Agaves.CollisionGroup.PLAYER,this.fixtureFeet.m_filter.groupIndex=-Agaves.CollisionGroup.PLAYER,this.fixtureFeet.isFeet=!0,this.fixtureBody=this.fixtureFeet.GetNext(),this.fixtureBody.m_filter.categoryBits=Agaves.CollisionGroup.PLAYER,this.fixtureBody.m_filter.groupIndex=-Agaves.CollisionGroup.PLAYER,this.fixtureBody.isBody=!0,this.fixtureLegs=this.fixtureBody.GetNext(),this.fixtureLegs.m_filter.categoryBits=Agaves.CollisionGroup.PLAYER,this.fixtureLegs.m_filter.groupIndex=-Agaves.CollisionGroup.PLAYER,this.fixtureLegs.isLegs=!0,this.fixtureSensor=this.fixtureLegs.GetNext(),this.fixtureSensor.SetSensor(!0),this.bulletDefinition=new Agaves.SpriteDefinition(Agaves.graphics["bullet-1"],Agaves.graphicsImage)},update:function(){switch(this.state){case this.State.IDLE:this.frame=0;break;case this.State.WALK:var a=this.box2d.GetPosition(),b=a.x*Agaves.RATIO,c=a.y*Agaves.RATIO,d=Math.round(b/2)%21;this.direction==this.Direction.LEFT?this.frame=20-d:this.direction==this.Direction.RIGHT&&(this.frame=d);break;case this.State.DEAD:}this.scaleX=this.direction==this.Direction.RIGHT?1:-1;var e=this.box2d.GetLinearVelocity();Math.abs(e.x)>this.MAX_VELOCITY_CAP&&this.applyFriction()},setState:function(a){this.state=a},setPosition:function(a,b){var c=new B.b2Vec2(a/Agaves.RATIO,b/Agaves.RATIO);this.box2d.SetPosition(c)},goUp:function(){if(!this.isDead){var a=this.box2d.GetLinearVelocity(),b=new B.b2Vec2(a.x,-this.VERTICAL_VELOCITY);this.box.SetLinearVelocity(b)}},goDown:function(){if(!this.isDead){var a=this.box2d.GetLinearVelocity(),b=new B.b2Vec2(a.x,this.VERTICAL_VELOCITY);this.box.SetLinearVelocity(b)}},goLeft:function(){if(!this.isDead){this.fixtureFeet.SetFriction(0),this.direction=this.Direction.LEFT;var a=this.box2d.GetLinearVelocity();if(a.x>-this.MAX_VELOCITY){var b=new B.b2Vec2(-this.ACCELERATION,0);this.box2d.ApplyImpulse(b,this.box2d.GetWorldCenter())}this.setState(this.State.WALK)}},goRight:function(){if(!this.isDead){this.fixtureFeet.SetFriction(0),this.direction=this.Direction.RIGHT;var a=this.box2d.GetLinearVelocity();if(a.x<this.MAX_VELOCITY){var b=new B.b2Vec2(this.ACCELERATION,0);this.box2d.ApplyImpulse(b,this.box2d.GetWorldCenter())}this.setState(this.State.WALK)}},jump:function(){if(this.canJump()&&!this.isDead){var a=this.box2d.GetLinearVelocity(),b=new B.b2Vec2(0,-this.JUMP);this.box2d.ApplyImpulse(b,this.box2d.GetWorldCenter())}},applyFriction:function(){if(!this.isDead){var a=this.box2d.GetLinearVelocity();this.fixtureFeet.SetFriction(this.FRICTION);if(Math.abs(a.x)>.4){var b=a.x<0?this.DAMPING:-this.DAMPING,c=new B.b2Vec2(b,0);this.box2d.ApplyImpulse(c,this.box2d.GetWorldCenter())}else this.box2d.SetLinearVelocity(new B.b2Vec2(0,a.y)),this.setState(this.State.IDLE)}},canJump:function(){if(!this.feetContact)return!1;var a=this.box2d.GetContactList();while(a!=null){var b=a.contact.GetFixtureA(),c=a.contact.GetFixtureB();if(b.isFeet||c.isFeet){var d=a.contact.GetManifold();if(d.m_pointCount>0){this.feetContact=!1;return!0}}a=a.next}return!1},fire:function(){if(!this.isDead){var a=new Agaves.Bullet(this.bulletDefinition);a.box2dDefinitions.bodyDef.bullet=!0;var b=this.box2d.GetPosition();if(this.direction==this.Direction.LEFT)var c=new B.b2Vec2(-5,0);else var c=new B.b2Vec2(5,0);a.x=b.x+5/Agaves.RATIO,a.y=b.y,a.addToWorld(this.box2d.GetWorld()),a.configure(),a.box2d.SetLinearVelocity(c),a.box2d.ignoreGravity=!0,a.box2d.dynamic=!0,a.box2d.objectType=Agaves.ObjectType.BULLET,Agaves.layer.add(a)}},kill:function(){this.isDead||(this.isDead=!0,this.state=this.State.DEAD,this.box2d.SetLinearVelocity(new B.b2Vec2(0,0)),this.box2d.DestroyFixture(this.fixtureSensor),this.box2d.DestroyFixture(this.fixtureFeet),this.box2d.DestroyFixture(this.fixtureLegs),this.box2d.DestroyFixture(this.fixtureBody),this.onKill&&this.onKill())},exit:function(){this.state=this.State.DEAD,this.box2d.SetLinearVelocity(new B.b2Vec2(0,0)),this.box2d.DestroyFixture(this.fixtureSensor),this.box2d.DestroyFixture(this.fixtureFeet),this.box2d.DestroyFixture(this.fixtureLegs),this.box2d.DestroyFixture(this.fixtureBody),this.onExit&&this.onExit()},hit:function(a){this.kill()}}),Agaves.Enemy=Agaves.Sprite.extend({init:function(a){this._super(a)}}),Agaves.WalkingEnemy=Agaves.Enemy.extend({BULLET_SPEED:80/Agaves.RATIO,PLAYER_SENSOR_SIZE:500/Agaves.RATIO,SHOCK_TIME:40,FRICTION:2,TURN_TIME:10,strength:5,direction:null,speed:7/Agaves.RATIO,isWalking:!1,shockCounter:1,fixtureFeet:null,fixtureBody:null,turnCounter:1,canTurn:!0,shootCounter:10,fixturePlayerSensor:null,isDead:!1,bulletDefinition:null,init:function(a,b){this._super(a),this.direction=b,this.setShootCounter(),this.bulletDefinition=new Agaves.SpriteDefinition(Agaves.graphics["bullet-enemy-1"],Agaves.graphicsImage)},configure:function(){this.box2d.SetFixedRotation(!0),this.box2d.objectType=Agaves.ObjectType.ENEMY,this.fixtureFeet=this.box2d.GetFixtureList(),this.fixtureFeet.m_filter.categoryBits=Agaves.CollisionGroup.ENEMY,this.fixtureFeet.m_filter.groupIndex=-Agaves.CollisionGroup.ENEMY,this.fixtureFeet.isFeet=!0,this.fixtureBody=this.fixtureFeet.GetNext(),this.fixtureBody.m_filter.categoryBits=Agaves.CollisionGroup.ENEMY,this.fixtureBody.m_filter.groupIndex=-Agaves.CollisionGroup.ENEMY,this.fixtureBody.isBody=!0;var a=new B.b2FixtureDef;a.shape=new B.b2PolygonShape,a.shape.SetAsBox(this.PLAYER_SENSOR_SIZE,this.PLAYER_SENSOR_SIZE/2),this.fixturePlayerSensor=this.box2d.CreateFixture(a),this.fixturePlayerSensor.SetSensor(!0),this.walk()},walk:function(){this.fixtureFeet.SetFriction(0);var a=this.speed;this.direction==Agaves.Direction.LEFT&&(a=-a);var b=new B.b2Vec2(a,0);this.box2d.SetLinearVelocity(b),this.box2d.SetAwake(!0),this.isWalking=!0},setShootCounter:function(){this.shootCounter=Agaves.Random.getInteger(100,200)},isPlayerAround:function(){var a=!1,b=this.box2d.GetWorld(),c=this.box2d.GetPosition(),d=new B.b2Transform(c,new B.b2Mat22),e=b.QueryShape(function(b){var c=b.GetBody();if(c.objectType==Agaves.ObjectType.PLAYER){a=!0;return!1}return!0},this.fixturePlayerSensor.GetShape(),d);return a},shoot:function(){if(this.isPlayerAround()&&this.isWalking){var a=new Agaves.EnemyBullet(this.bulletDefinition);a.box2dDefinitions.bodyDef.bullet=!0;var b=this.box2d.GetPosition();if(this.direction==Agaves.Direction.LEFT)var c=new B.b2Vec2(-this.BULLET_SPEED,0);else var c=new B.b2Vec2(this.BULLET_SPEED,0);a.x=b.x,a.y=b.y+10/Agaves.RATIO,a.addToWorld(this.box2d.GetWorld()),a.configure(),a.box2d.SetLinearVelocity(c),a.box2d.ignoreGravity=!0,a.box2d.dynamic=!0,a.box2d.objectType=Agaves.ObjectType.ENEMY_BULLET,Agaves.layer.add(a)}this.setShootCounter()},process:function(){if(!this.isDead){if(!this.isWalking)this.shockCounter==0?this.walk():(this.shockCounter--,this.frame=14);else{var a=this.box2d.GetPosition(),b=a.x*Agaves.RATIO,c=a.y*Agaves.RATIO,d=Math.round(b/2)%14;this.direction==Agaves.Direction.LEFT?this.frame=13-d:this.direction==Agaves.Direction.RIGHT&&(this.frame=d),this.scaleX=this.direction==Agaves.Direction.RIGHT?1:-1}this.turnCounter==0?this.canTurn=!0:this.turnCounter--,this.shootCounter==0?this.shoot():this.shootCounter--}},hit:function(){this.fixtureFeet.SetFriction(this.FRICTION),this.isWalking=!1,this.shockCounter=this.SHOCK_TIME,this.strength--,this.strength==0&&!this.destroy&&this.kill()},kill:function(){this.isDead=!0,this.animate({start:14,end:23,speed:2,callback:function(a){a.destroy=!0}})},turn:function(){this.direction==Agaves.Direction.LEFT?this.direction=Agaves.Direction.RIGHT:this.direction=Agaves.Direction.LEFT},stop:function(){this.canTurn&&(this.turnCounter=this.TURN_TIME,this.canTurn=!1,this.turn(),this.walk())}}),Agaves.StandingEnemy=Agaves.Enemy.extend({BULLET_SPEED:80/Agaves.RATIO,PLAYER_SENSOR_SIZE:500/Agaves.RATIO,SHOCK_TIME:40,strength:10,direction:null,shockCounter:1,fixtureBody:null,shootCounter:10,isDead:!1,bulletDefinition:null,init:function(a,b){this._super(a),this.direction=b,this.setShootCounter(),this.bulletDefinition=new Agaves.SpriteDefinition(Agaves.graphics["ball-1"],Agaves.graphicsImage)},configure:function(){this.box2d.SetFixedRotation(!0),this.box2d.objectType=Agaves.ObjectType.ENEMY,this.fixtureBody=this.box2d.GetFixtureList(),this.fixtureBody.m_filter.categoryBits=Agaves.CollisionGroup.ENEMY,this.fixtureBody.m_filter.groupIndex=-Agaves.CollisionGroup.ENEMY,this.fixtureBody.isBody=!0,this.scaleX=this.direction==Agaves.Direction.RIGHT?1:-1},setShootCounter:function(){this.shootCounter=Agaves.Random.getInteger(100,200)},stop:function(){},shoot:function(){var a=new Agaves.EnemyBall(this.bulletDefinition);a.box2dDefinitions.bodyDef.bullet=!0;var b=this.box2d.GetPosition();if(this.direction==Agaves.Direction.LEFT)var c=new B.b2Vec2(-this.BULLET_SPEED,0);else var c=new B.b2Vec2(this.BULLET_SPEED,0);a.x=b.x,a.y=b.y+10/Agaves.RATIO,a.addToWorld(this.box2d.GetWorld()),a.configure(),a.box2d.SetLinearVelocity(c),a.box2d.dynamic=!0,a.box2d.objectType=Agaves.ObjectType.ENEMY_BULLET,Agaves.layer.add(a),this.setShootCounter()},process:function(){this.isDead||(this.shockCounter==0?this.frame=0:(this.shockCounter--,this.frame=1),this.shootCounter==0?this.shoot():this.shootCounter--)},hit:function(){this.shockCounter=this.SHOCK_TIME,this.strength--,this.strength==0&&!this.destroy&&this.kill()},kill:function(){this.isDead=!0,this.animate({start:1,end:15,speed:2,callback:function(a){a.destroy=!0}})}}),Agaves.FlyingEnemy=Agaves.Enemy.extend({BULLET_SPEED:60/Agaves.RATIO,PLAYER_SENSOR_WIDTH:500/Agaves.RATIO,PLAYER_SENSOR_HEIGHT:300/Agaves.RATIO,SHOCK_TIME:40,FRICTION:2,TURN_TIME:10,strength:2,direction:null,speed:7/Agaves.RATIO,isFlying:!1,shockCounter:1,fixtureBody:null,turnCounter:1,canTurn:!0,shootCounter:10,fixturePlayerSensor:null,isDead:!1,bulletDefinition:null,init:function(a,b){this._super(a),this.direction=b,this.setShootCounter(),this.bulletDefinition=new Agaves.SpriteDefinition(Agaves.graphics["bullet-enemy-1"],Agaves.graphicsImage)},configure:function(){this.box2d.SetFixedRotation(!0),this.box2d.objectType=Agaves.ObjectType.ENEMY,this.box2d.ignoreGravity=!0,this.fixtureBody=this.box2d.GetFixtureList(),this.fixtureBody.m_filter.categoryBits=Agaves.CollisionGroup.ENEMY,this.fixtureBody.m_filter.groupIndex=-Agaves.CollisionGroup.ENEMY,this.fixtureBody.isBody=!0;var a=new B.b2FixtureDef;a.shape=new B.b2PolygonShape,a.shape.SetAsBox(this.PLAYER_SENSOR_WIDTH,this.PLAYER_SENSOR_HEIGHT),this.fixturePlayerSensor=this.box2d.CreateFixture(a),this.fixturePlayerSensor.SetSensor(!0),this.fly()},fly:function(){var a=this.speed;this.direction==Agaves.Direction.LEFT&&(a=-a);var b=new B.b2Vec2(a,0);this.box2d.SetLinearVelocity(b),this.box2d.SetAwake(!0),this.isFlying=!0},setShootCounter:function(){this.shootCounter=Agaves.Random.getInteger(150,300)},isPlayerAround:function(){var a=!1,b=this.box2d.GetWorld(),c=this.box2d.GetPosition(),d=new B.b2Transform(c,new B.b2Mat22),e=b.QueryShape(function(b){var c=b.GetBody();if(c.objectType==Agaves.ObjectType.PLAYER){a=!0;return!1}return!0},this.fixturePlayerSensor.GetShape(),d);return a},shoot:function(){if(this.isPlayerAround()&&this.isFlying){var a=new Agaves.EnemyBullet(this.bulletDefinition);a.box2dDefinitions.bodyDef.bullet=!0;var b=this.box2d.GetWorldCenter(),c=Agaves.player.box2d.GetWorldCenter(),d=b.Copy();d.NegativeSelf(),d.Add(c),d.Normalize(),d.Multiply(this.BULLET_SPEED),a.x=b.x,a.y=b.y,a.addToWorld(this.box2d.GetWorld()),a.configure(),a.box2d.SetLinearVelocity(d),a.box2d.ignoreGravity=!0,a.box2d.dynamic=!0,a.box2d.objectType=Agaves.ObjectType.ENEMY_BULLET,Agaves.layer.add(a)}this.setShootCounter()},process:function(){this.isDead||(this.isFlying?this.scaleX=this.direction==Agaves.Direction.RIGHT?1:-1:this.shockCounter==0?this.fly():(this.shockCounter--,this.frame=0),this.turnCounter==0?this.canTurn=!0:this.turnCounter--,this.shootCounter==0?this.shoot():this.shootCounter--)},hit:function(){this.isFlying=!1,this.shockCounter=this.SHOCK_TIME,this.strength--,this.strength==0&&!this.destroy&&this.kill()},kill:function(){this.isDead=!0,this.destroy=!0},turn:function(){this.direction==Agaves.Direction.LEFT?this.direction=Agaves.Direction.RIGHT:this.direction=Agaves.Direction.LEFT},stop:function(){this.canTurn&&(this.turnCounter=this.TURN_TIME,this.canTurn=!1,this.turn(),this.fly())}}),Agaves.Bullet=Agaves.Sprite.extend({init:function(a){this._super(a)},configure:function(){var a=this.box2d.GetFixtureList();a.m_filter.categoryBits=Agaves.CollisionGroup.BULLET,a.m_filter.groupIndex=-Agaves.CollisionGroup.BULLET,a.m_filter.maskBits=(Agaves.CollisionGroup.PLAYER|Agaves.CollisionGroup.ENEMY_BULLET)^65535},explode:function(a){a&&this.box2d.SetLinearVelocity(new B.b2Vec2(0,0)),this.animate({start:0,end:5,speed:2,callback:function(a){a.destroy=!0},onFrame:function(a,b){if(b==1){a.box2d.SetLinearVelocity(new B.b2Vec2(0,0));var c=a.box2d.GetFixtureList();c.SetSensor(!0)}}})}}),Agaves.EnemyBullet=Agaves.Sprite.extend({init:function(a){this._super(a)},configure:function(){var a=this.box2d.GetFixtureList();a.m_filter.categoryBits=Agaves.CollisionGroup.ENEMY_BULLET,a.m_filter.groupIndex=-Agaves.CollisionGroup.ENEMY_BULLET,a.m_filter.maskBits=65535-Agaves.CollisionGroup.ENEMY},explode:function(){this.animate({start:0,end:5,speed:2,callback:function(a){a.destroy=!0},onFrame:function(a,b){if(b==1){var c=this.box2d.GetFixtureList();c.SetSensor(!0)}}})}}),Agaves.EnemyBall=Agaves.Sprite.extend({init:function(a){this._super(a)},configure:function(){var a=this.box2d.GetFixtureList();a.m_filter.categoryBits=Agaves.CollisionGroup.ENEMY_BULLET,a.m_filter.groupIndex=-Agaves.CollisionGroup.ENEMY_BULLET,a.m_filter.maskBits=65535-Agaves.CollisionGroup.ENEMY},explode:function(){this.destroy=!0}}),Agaves.Collisions={processPlayer:function(a,b,c){var d=b.GetBody(),e=b.GetAABB(),f=c.GetBody();if(f.objectType==Agaves.ObjectType.PLATFORM_ONE_SIDE){var g=c.GetAABB(),h=g.lowerBound.y-e.upperBound.y,i=d.GetLinearVelocity();(i.y<4&&h<-0.2||Agaves.Keyboard.isPressed(Agaves.Controls.DOWN))&&a.SetEnabled(!1)}else if(f.objectType==Agaves.ObjectType.PLATFORM_MOVING&&b.isFeet){var j=d.GetPosition(),k=c.GetBody();if(!Agaves.Keyboard.isPressed(Agaves.Controls.LEFT)&&!Agaves.Keyboard.isPressed(Agaves.Controls.RIGHT)){var k=c.GetBody(),g=c.GetAABB(),h=g.lowerBound.y-e.upperBound.y,i=d.GetLinearVelocity();if(h>-0.5){var l=k.GetLinearVelocity();if(l.x!=0){var m=new B.b2Vec2(l.x,i.y);d.SetLinearVelocity(m),Agaves.player.state=Agaves.player.State.IDLE}}}}},processPlayerContact:function(a,b,c){var d=c.GetBody(),e=b.GetBody();if(b.IsSensor())switch(d.objectType){case Agaves.ObjectType.EXIT:Agaves.player.exit();break;case Agaves.ObjectType.FIRE:Agaves.player.kill();break;case Agaves.ObjectType.ENEMY:c.IsSensor()||Agaves.player.kill();break;case Agaves.ObjectType.COIN:d.sprite.collect()}if(b.isFeet){var f=e.GetLinearVelocity();f.y>=0&&(e.sprite.feetContact=!0)}},processPlayerPost:function(a,b,c,d){var e=d.GetBody(),f=c.GetBody();if(e.objectType==Agaves.ObjectType.PLATFORM_MOVING&&c.isFeet){var g=e.GetLinearVelocity();console.log(f),f.sprite.dx=.004}},processBullet:function(a,b,c){if(!b.IsSensor()){var d=b.GetBody(),e=c.GetBody();c.IsSensor()||(e.objectType==Agaves.ObjectType.ENEMY?(e.sprite.hit(d.sprite),d.sprite.explode(!0)):d.sprite.explode(!1))}},processEnemyBullet:function(a,b,c){if(!b.IsSensor()){var d=b.GetBody(),e=c.GetBody();c.IsSensor()?e.objectType==Agaves.ObjectType.FIRE&&d.sprite.explode():(d.sprite instanceof Agaves.EnemyBall||d.sprite.explode(),e.objectType==Agaves.ObjectType.PLAYER&&e.sprite.hit(d.sprite))}},processEnemy:function(a,b,c){if(!b.IsSensor()){var d=b.GetBody(),e=c.GetBody();e.objectType==Agaves.ObjectType.PLATFORM?d.sprite.stop():e.objectType==Agaves.ObjectType.ENEMY_STOP_LEFT?d.sprite.direction==Agaves.Direction.LEFT&&d.sprite.stop():e.objectType==Agaves.ObjectType.ENEMY_STOP_RIGHT&&d.sprite.direction==Agaves.Direction.RIGHT&&d.sprite.stop()}}},Agaves.ContactListener=new B.b2ContactListener,Agaves.ContactListener.PreSolve=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();d.objectType==Agaves.ObjectType.PLAYER?Agaves.Collisions.processPlayer(a,b,c):e.objectType==Agaves.ObjectType.PLAYER&&Agaves.Collisions.processPlayer(a,c,b)},Agaves.ContactListener.BeginContact=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();d.objectType==Agaves.ObjectType.BULLET?Agaves.Collisions.processBullet(a,b,c):e.objectType==Agaves.ObjectType.BULLET&&Agaves.Collisions.processBullet(a,c,b),d.objectType==Agaves.ObjectType.ENEMY?Agaves.Collisions.processEnemy(a,b,c):e.objectType==Agaves.ObjectType.ENEMY&&Agaves.Collisions.processEnemy(a,c,b),d.objectType==Agaves.ObjectType.ENEMY_BULLET?Agaves.Collisions.processEnemyBullet(a,b,c):e.objectType==Agaves.ObjectType.ENEMY_BULLET&&Agaves.Collisions.processEnemyBullet(a,c,b),d.objectType==Agaves.ObjectType.PLAYER?Agaves.Collisions.processPlayerContact(a,b,c):e.objectType==Agaves.ObjectType.PLAYER&&Agaves.Collisions.processPlayerContact(a,c,b)}